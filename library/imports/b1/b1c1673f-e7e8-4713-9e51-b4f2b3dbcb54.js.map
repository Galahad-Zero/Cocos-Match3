{"version":3,"sources":["assets\\Script\\HotUpdateMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import HotUpdatePanel from './HotUpdatePanel';\n\nconst { ccclass, property } = cc._decorator;\n\n/**\n * 版本号比较函数\n * @param versionA 版本号A\n * @param versionB 版本号B\n * @returns 如果版本号A大于版本号B, 返回1; 如果版本号A小于版本号B, 返回-1; 如果版本号A等于版本号B, 返回0\n */\nfunction versionCompareHandle(versionA: string, versionB: string): number {\n    cc.log(\n        '热更新版本号比较: version A is ' +\n            versionA +\n            ', version B is ' +\n            versionB\n    );\n    const vA = versionA.split('.');\n    const vB = versionB.split('.');\n    for (let i = 0; i < vA.length; ++i) {\n        const a = parseInt(vA[i]);\n        const b = parseInt(vB[i] || '0');\n        if (a === b) {\n            continue;\n        } else {\n            return a - b;\n        }\n    }\n    if (vB.length > vA.length) {\n        return -1;\n    } else {\n        return 0;\n    }\n}\n\n@ccclass\nexport default class HotUpdateMgr extends cc.Component {\n    @property(cc.Asset)\n    manifestUrl: cc.Asset = null;\n\n    @property(HotUpdatePanel)\n    hotUpdatePanel: HotUpdatePanel = null;\n\n    // 热更新资源管理器\n    _am: jsb.AssetsManager = null;\n    // 热更新资源存储路径\n    _storagePath: string = '';\n    // 是否正在更新\n    _updating: boolean = false;\n    // 是否可以重试\n    _canRetry: boolean = false;\n    // 失败次数\n    _failCount: number = 0;\n\n    /**\n     * 加载, 初始化热更新资源管理器\n     */\n    protected onLoad(): void {\n        if (!cc.sys.isNative) {\n            this.hotUpdatePanel.node.active = false;\n            return;\n        }\n        // 获取存储路径, 用于存储热更新资源\n        this._storagePath =\n            (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') +\n            'match-3-remote-asset';\n        cc.log('热更新资源存储路径: ' + this._storagePath);\n        // 初始化热更新资源管理器\n        this._am = new jsb.AssetsManager(\n            '',\n            this._storagePath,\n            versionCompareHandle\n        );\n\n        // 设置验证回调，用于验证资源是否下载正确\n        this._am.setVerifyCallback((path, asset) => {\n            // 是否是压缩文件\n            const compressed = asset.compressed;\n            // md5值\n            const expectedMD5 = asset.md5;\n            // 相对路径\n            const relativePath = asset.path;\n            // 文件大小\n            //const size = asset.size;\n            if (compressed) {\n                this.hotUpdatePanel.setInfo('验证通过: ' + relativePath);\n                return true;\n            } else {\n                this.hotUpdatePanel.setInfo(\n                    '验证通过: ' + relativePath + ' (' + expectedMD5 + ')'\n                );\n                return true;\n            }\n        });\n\n        this.hotUpdatePanel.setInfo('热更新准备就绪，请检查或直接更新。');\n\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\n            // 某些Android设备在并发任务过多时可能会降低下载速度。\n            // 该值可能不准确，请进行更多测试，找到最适合您的游戏的值。\n            // 设置最大并发任务数为2\n            (this._am as any).setMaxConcurrentTask &&\n                (this._am as any).setMaxConcurrentTask(2);\n            this.hotUpdatePanel.setInfo('最大并发任务数限制为2');\n        }\n\n        // 设置文件进度和字节进度\n        this.hotUpdatePanel.setFileProgress(0);\n        this.hotUpdatePanel.setByteProgress(0);\n    }\n\n    private checkCb(event: jsb.EventAssetsManager): void {\n        cc.log('热更新检查回调 Code: ' + event.getEventCode());\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                // 没有找到本地清单文件，热更新跳过\n                this.hotUpdatePanel.setInfo(\n                    '没有找到本地清单文件，热更新跳过...'\n                );\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n                // 下载清单文件失败，热更新跳过\n                this.hotUpdatePanel.setInfo('下载清单文件失败，热更新跳过...');\n                break;\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                // 解析清单文件失败，热更新跳过\n                this.hotUpdatePanel.setInfo('解析清单文件失败，热更新跳过...');\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                // 已经是最新版本，热更新跳过\n                this.hotUpdatePanel.setInfo('已经是最新版本，热更新跳过...');\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                // 发现新版本，请尝试更新\n                this.hotUpdatePanel.setInfo(\n                    '发现新版本，请尝试更新... (总字节数: ' +\n                        this._am.getTotalBytes() +\n                        'bytes)'\n                );\n                // 设置检查按钮为不可用\n                this.hotUpdatePanel.setCheckBtnActive(false);\n                // 设置文件进度为0\n                this.hotUpdatePanel.setFileProgress(0);\n                // 设置字节进度为0\n                this.hotUpdatePanel.setByteProgress(0);\n                break;\n            default:\n                return;\n        }\n        // 设置事件回调为空\n        this._am.setEventCallback(null);\n        // 设置正在更新状态为false\n        this._updating = false;\n    }\n\n    /**\n     * 检查更新\n     */\n    public checkUpdate(): void {\n        if (this._updating) {\n            this.hotUpdatePanel.setInfo('正在检查或更新...');\n            return;\n        }\n        // 如果资源管理器未初始化，则加载本地清单\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            // 解析md5 url\n            let url = this.manifestUrl.nativeUrl;\n            if (cc.loader.md5Pipe) {\n                // 使用md5管道转换url\n                url = cc.loader.md5Pipe.transformURL(url);\n            }\n            // 加载本地清单\n            this._am.loadLocalManifest(url);\n        }\n        // 如果本地清单未加载或未加载完成，则返回\n        if (\n            !this._am.getLocalManifest() ||\n            !this._am.getLocalManifest().isLoaded()\n        ) {\n            this.hotUpdatePanel.setInfo('加载本地清单失败...');\n            return;\n        }\n        // 设置事件回调\n        this._am.setEventCallback(this.checkCb.bind(this));\n        // 开始检查更新\n        this._am.checkUpdate();\n        // 设置正在更新状态为true\n        this._updating = true;\n    }\n\n    private updateCb(event: jsb.EventAssetsManager): void {\n        var needRestart = false;\n        var failed = false;\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.hotUpdatePanel.setInfo(\n                    '没有找到本地清单文件，热更新跳过...'\n                );\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                // 设置字节进度\n                this.hotUpdatePanel.setByteProgress(event.getPercent());\n                // 设置文件进度\n                this.hotUpdatePanel.setFileProgress(event.getPercentByFile());\n                // 设置文件标签: 已下载文件数 / 总文件数\n                this.hotUpdatePanel.setFileLabel(\n                    event.getDownloadedFiles() + ' / ' + event.getTotalFiles()\n                );\n                // 设置字节标签: 已下载字节数 / 总字节数\n                this.hotUpdatePanel.setByteLabel(\n                    event.getDownloadedBytes() + ' / ' + event.getTotalBytes()\n                );\n                // 设置信息: 更新文件\n                var msg = event.getMessage();\n                if (msg) {\n                    this.hotUpdatePanel.setInfo('Updated file: ' + msg);\n                }\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                // 下载、解析清单文件失败，热更新跳过\n                this.hotUpdatePanel.setInfo(\n                    '下载、解析清单文件失败，热更新跳过...'\n                );\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                // 已经是最新版本，热更新跳过\n                this.hotUpdatePanel.setInfo('已经是最新版本，热更新跳过...');\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                // 更新完成\n                this.hotUpdatePanel.setInfo(\n                    '更新完成... ' + event.getMessage()\n                );\n                // 设置需要重启为true\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                // 更新失败\n                this.hotUpdatePanel.setInfo(\n                    '更新失败... ' + event.getMessage()\n                );\n                // 设置重试按钮为可用\n                this.hotUpdatePanel.setRetryBtnActive(true);\n                // 设置正在更新状态为false\n                this._updating = false;\n                // 设置可以重试为true\n                this._canRetry = true;\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                // 资源更新错误\n                this.hotUpdatePanel.setInfo(\n                    '资源更新错误: ' +\n                        event.getAssetId() +\n                        ', ' +\n                        event.getMessage()\n                );\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                // 解压错误\n                this.hotUpdatePanel.setInfo('解压错误: ' + event.getMessage());\n                break;\n            default:\n                break;\n        }\n\n        if (failed) {\n            // 设置事件回调为空\n            this._am.setEventCallback(null);\n            this._updating = false;\n        }\n\n        // 如果需要重启，则重启游戏\n        if (needRestart) {\n            // 设置事件回调为空\n            this._am.setEventCallback(null);\n            // 获取搜索路径\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            //它返回的是一个数组，数组中第一个元素永远是 storagePath，然后才是 manifest 中的 searchPaths 列表（都会跟 storagePath 拼接）\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            // 将新的搜索路径添加到搜索路径列表中\n            for (var i = 0; i < newPaths.length; i++) {\n                if (searchPaths.indexOf(newPaths[i]) == -1) {\n                    Array.prototype.unshift.apply(searchPaths, [newPaths[i]]);\n                }\n            }\n            // 将搜索路径列表保存到本地存储\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n            cc.sys.localStorage.setItem(\n                'HotUpdateSearchPaths',\n                JSON.stringify(searchPaths)\n            );\n            // 设置搜索路径\n            jsb.fileUtils.setSearchPaths(searchPaths);\n            // 停止所有音频\n            cc.audioEngine.stopAll();\n            // 重启游戏\n            cc.game.restart();\n        }\n    }\n\n    /**\n     * 热更新\n     */\n    public hotUpdate(): void {\n        if (this._am && !this._updating) {\n            // 设置事件回调\n            this._am.setEventCallback(this.updateCb.bind(this));\n            // 如果资源管理器未初始化，则加载本地清单\n            if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n                // Resolve md5 url\n                var url = this.manifestUrl.nativeUrl;\n                if (cc.loader.md5Pipe) {\n                    // 使用md5管道转换url\n                    url = cc.loader.md5Pipe.transformURL(url);\n                }\n                // 加载本地清单\n                this._am.loadLocalManifest(url);\n            }\n\n            // 重置失败次数\n            this._failCount = 0;\n            // 开始更新\n            this._am.update();\n            // 设置更新按钮为不可用\n            this.hotUpdatePanel.setUpdateBtnActive(false);\n            // 设置正在更新状态为true\n            this._updating = true;\n        }\n    }\n\n    public retry(): void {\n        if (!this._updating && this._canRetry) {\n            this.hotUpdatePanel.setRetryBtnActive(false);\n            this._canRetry = false;\n            // 设置信息: 重试失败资源下载\n            this.hotUpdatePanel.setInfo('重试失败资源下载...');\n            this._am.downloadFailedAssets();\n        }\n    }\n\n    public showUpdateUI(): void {\n        this.hotUpdatePanel.node.active = true;\n    }\n\n    protected onDestroy(): void {\n        this._am && this._am.setEventCallback(null);\n    }\n}\n"]}