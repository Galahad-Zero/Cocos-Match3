{"version":3,"sources":["assets\\Script\\gamePlay\\PlayPanel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BaseBlock from './block/BaseBlock';\nimport Grid, { parseLocation } from './common/Grid';\nimport { getRandomBlockConfig, isLocationEqual } from './common/GameUtils';\nimport {\n    BlockConfig,\n    BlockDropInfo,\n    BlockSpecialType,\n    BlockType,\n    GameCheckInfo,\n    LevelConfig,\n    Location,\n} from './GameTypes';\nimport EffectMgr from './effects/EffectMgr';\nimport BlockMgr from './block/BlockMgr';\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class PlayPanel extends cc.Component {\n    @property(cc.Node)\n    gridRootNode: cc.Node = null;\n\n    @property({\n        displayName: '网格行数',\n        min: 1,\n        step: 1,\n    })\n    rowCount: number = 6;\n\n    @property({\n        displayName: '网格列数',\n        min: 1,\n        step: 1,\n    })\n    columnCount: number = 8;\n\n    @property({\n        displayName: '网格单位宽度',\n    })\n    cellWidth: number = 70;\n\n    @property({\n        displayName: '网格单位高度',\n    })\n    cellHeight: number = 70;\n\n    @property({\n        displayName: '网格单位间距',\n    })\n    cellSpacing: number = 2;\n\n    _grid: Grid<BaseBlock> = null;\n    _blockMgr: BlockMgr = null;\n    _effectMgr: EffectMgr = null;\n    _levelConfig: LevelConfig = null;\n    _blockParentMap: Map<BlockType, cc.Node> = new Map();\n\n    public initGamePanel(\n        levelConfig: LevelConfig,\n        blockMgr: BlockMgr,\n        effectMgr: EffectMgr\n    ): void {\n        this._blockMgr = blockMgr;\n        this._effectMgr = effectMgr;\n        this._levelConfig = levelConfig;\n        // 初始化网格数据\n        this.initGrid(levelConfig);\n        // 初始化方块\n        this.initBlocks();\n    }\n\n    protected initGrid(levelConfig: LevelConfig): void {\n        const { width, height } = levelConfig.gameMap;\n        this._grid = new Grid(\n            width,\n            height,\n            new cc.Size(this.cellWidth, this.cellHeight),\n            this.cellSpacing\n        );\n        this.gridRootNode.setContentSize(this._grid.getGridSize());\n        this.node.setContentSize(this._grid.getGridSize());\n    }\n\n    protected initBlocks(): void {\n        const blockInfos = this._levelConfig.gameMap.blocks;\n        const keys = Object.keys(blockInfos);\n        for (const key of keys) {\n            const { row, column } = parseLocation(key);\n            const blockConfig = blockInfos[key];\n            this.generateBlock({ row, column }, blockConfig);\n        }\n    }\n\n    public getBlockParent(blockType: BlockType): cc.Node {\n        let blockParent = this._blockParentMap.get(blockType);\n        if (!blockParent) {\n            blockParent = new cc.Node(`block_parent_${blockType}`);\n            this._blockParentMap.set(blockType, blockParent);\n            this.gridRootNode.addChild(blockParent);\n        }\n        return blockParent;\n    }\n\n    public getBlockByLocation(location: Location): BaseBlock {\n        if (this._grid.isInBounds(location)) {\n            return this._grid.getCell(location);\n        }\n        return null;\n    }\n\n    public getBlockByPosition(position: cc.Vec2): BaseBlock {\n        const location = this._grid.getTouchedLocation(position);\n        return location ? this.getBlockByLocation(location) : null;\n    }\n\n    public getLocationByPosition(position: cc.Vec2): {\n        row: number;\n        column: number;\n    } {\n        return this._grid.getTouchedLocation(position);\n    }\n\n    // 获取相连的方块\n    public getContiguousBlocks(\n        location: Location,\n        mapInfo: Array<Array<BlockConfig>>,\n        excludeLocations: Array<Location>\n    ): Array<Location> {\n        if (\n            excludeLocations.some((excludeLocation) =>\n                isLocationEqual(excludeLocation, location)\n            )\n        ) {\n            return [];\n        }\n        const contiguousLocations: Array<Location> = [];\n        const queue: Array<Location> = [location];\n\n        const typeIsSame = (\n            location1: Location,\n            location2: Location\n        ): boolean => {\n            const config1 = mapInfo[location1.row][location1.column];\n            const config2 = mapInfo[location2.row][location2.column];\n            // 特殊炸弹方块不能与普通方块相连\n            return (\n                config1.type === config2.type &&\n                config1.special !== BlockSpecialType.SPECIAL_BOOM &&\n                config2.special !== BlockSpecialType.SPECIAL_BOOM\n            );\n        };\n\n        const hasContiguous = (location1: Location): boolean => {\n            return contiguousLocations.some((location2) =>\n                isLocationEqual(location1, location2)\n            );\n        };\n\n        const hasExclude = (location1: Location): boolean => {\n            return excludeLocations.some((excludeLocation) =>\n                isLocationEqual(location1, excludeLocation)\n            );\n        };\n\n        const inQueue = (location1: Location): boolean => {\n            return queue.some((location2) =>\n                isLocationEqual(location1, location2)\n            );\n        };\n\n        // 获取相邻的连续方块\n        while (queue.length > 0) {\n            const currentLocation = queue.shift();\n            contiguousLocations.push(currentLocation);\n            const neighborsLocations =\n                this._grid.getNeighborsLocations(currentLocation);\n            for (const neighborLocation of neighborsLocations) {\n                if (\n                    typeIsSame(currentLocation, neighborLocation) &&\n                    !hasContiguous(neighborLocation) &&\n                    !hasExclude(neighborLocation) &&\n                    !inQueue(neighborLocation)\n                ) {\n                    // 如果相邻方块类型相同，且未被访问过，且未在队列中，则加入队列\n                    queue.push(neighborLocation);\n                }\n            }\n        }\n        const rowList = contiguousLocations.map((location) => location.row);\n        const columnList = contiguousLocations.map(\n            (location) => location.column\n        );\n        const rowSet = new Set(rowList);\n        const columnSet = new Set(columnList);\n        // 有效的连续方块\n        const validContiguousLocations: Array<Location> = [];\n        // 按行分类,同一行内不满三个的方块，需要排除\n        rowSet.forEach((row) => {\n            const rowLocations = contiguousLocations.filter(\n                (location) => location.row === row\n            );\n            if (rowLocations.length >= 3) {\n                validContiguousLocations.push(...rowLocations);\n            }\n        });\n        // 按列分类,同一列内不满三个的方块，需要排除\n        columnSet.forEach((column) => {\n            const columnLocations = contiguousLocations.filter(\n                (location) => location.column === column\n            );\n            if (columnLocations.length >= 3) {\n                validContiguousLocations.push(...columnLocations);\n            }\n        });\n\n        // 去重\n        return [...new Set(validContiguousLocations)];\n    }\n\n    public eliminateBlocks(gameCheckInfo: GameCheckInfo, cd: () => void): void {\n        const { swapBlocks } = gameCheckInfo;\n        // 交换方块, 并消除方块\n        if (swapBlocks) {\n            const [location1, location2] = swapBlocks;\n            const block1 = this.getBlockByLocation(location1);\n            const block2 = this.getBlockByLocation(location2);\n            this.swapBlocks(block1, block2, location1, location2, () => {\n                // 消除方块\n                this.eliminateHandler(gameCheckInfo, cd);\n            });\n        } else {\n            // 没有交换方块，直接消除方块\n            this.eliminateHandler(gameCheckInfo, cd);\n        }\n    }\n\n    protected eliminateHandler(\n        gameCheckInfo: GameCheckInfo,\n        cd: () => void\n    ): void {\n        // 消除方块\n        const { canEliminateCheckInfos } = gameCheckInfo;\n        for (const eliminateCheckInfo of canEliminateCheckInfos) {\n            const { contiguousLocations } = eliminateCheckInfo;\n            for (const location of contiguousLocations) {\n                const block = this.getBlockByLocation(location);\n                this.putBlock(block, location);\n            }\n        }\n        // 释放特效\n        this._effectMgr.effectHandler(this._grid, gameCheckInfo, cd);\n        // cd && cd();\n    }\n\n    public putBlock(block: BaseBlock, location: Location): void {\n        // 网格数据清除\n        this._grid.setCell(location, null);\n        // 将方块放回方块池\n        this._blockMgr.putBlock(block);\n    }\n\n    public swapBlocks(\n        block1: BaseBlock,\n        block2: BaseBlock,\n        location1: Location,\n        location2: Location,\n        cd: () => void\n    ): void {\n        // 交换\n        this._grid.setCell(location1, block2);\n        this._grid.setCell(location2, block1);\n\n        const pos1 = this._grid.getCellPosition(location1);\n        const pos2 = this._grid.getCellPosition(location2);\n\n        let step = 0;\n        const actionCd = () => {\n            step++;\n            if (step === 2) {\n                cd();\n            }\n        };\n\n        const nodeActionSeq1 = cc.sequence(\n            cc.moveTo(0.3, pos2),\n            cc.callFunc(actionCd)\n        );\n\n        const nodeActionSeq2 = cc.sequence(\n            cc.moveTo(0.3, pos1),\n            cc.callFunc(actionCd)\n        );\n        // 交换、还原动画\n        block1.node.runAction(nodeActionSeq1);\n        block2.node.runAction(nodeActionSeq2);\n    }\n\n    public swapAndBackBlocks(\n        location1: Location,\n        location2: Location,\n        cd: () => void\n    ): void {\n        // 获取方块\n        const block1 = this.getBlockByLocation(location1);\n        const block2 = this.getBlockByLocation(location2);\n        // 只交换位置，不交换方块\n        const pos1 = this._grid.getCellPosition(location1);\n        const pos2 = this._grid.getCellPosition(location2);\n\n        let step = 0;\n        const actionCd = () => {\n            step++;\n            if (step === 2) {\n                cd();\n            }\n        };\n\n        // 交换、还原动画\n        cc.tween(block1.node)\n            .sequence(\n                cc.moveTo(0.3, pos2),\n                cc.moveTo(0.3, pos1),\n                cc.callFunc(actionCd)\n            )\n            .start();\n        cc.tween(block2.node)\n            .sequence(\n                cc.moveTo(0.3, pos1),\n                cc.moveTo(0.3, pos2),\n                cc.callFunc(actionCd)\n            )\n            .start();\n    }\n\n    public dropRandomBlocks(cd: (entryList: Array<Location>) => void): void {\n        // 根据含有空位的列生成随机方块\n        const emptyList: Record<string, Array<Location>> = {};\n        const data = this._grid.getData();\n        for (let row = 0; row < data.length; row++) {\n            const rowData = data[row];\n            for (let column = 0; column < rowData.length; column++) {\n                const cell = rowData[column];\n                if (cell === null) {\n                    if (!emptyList[column]) {\n                        emptyList[column] = [];\n                    }\n                    emptyList[column].push({ row, column });\n                }\n            }\n        }\n        const entryList: Array<Location> = [];\n        // 先将悬空的方块向下掉落，再补位\n        const blockDropInfos: Array<BlockDropInfo> = [];\n        for (const columnKey in emptyList) {\n            const column = Number(columnKey);\n            const columnList = emptyList[column];\n            // 空位的最高行\n            // const maxRow = columnList[columnList.length - 1].row;\n            let startDropRow = columnList[0].row;\n            // 先掉落存在的方块\n            for (let row = startDropRow + 1; row < data.length; row++) {\n                const cell = data[row][column];\n                if (!cell) {\n                    continue;\n                }\n                const targetLocation = {\n                    row: startDropRow++,\n                    column: column,\n                };\n                // 添加到入口列表\n                entryList.push(targetLocation);\n                // 有方块，则将方块掉落到目标位置\n                blockDropInfos.push({\n                    location: { row, column },\n                    block: cell,\n                    dropTime: 0.3,\n                    targetDropLocation: targetLocation,\n                });\n                // 清除原位置\n                this._grid.setCell({ row, column }, null);\n                // 放置新位置\n                this._grid.setCell(targetLocation, cell);\n            }\n            let startGenerateRow = data.length;\n            // 再生成空位需要的方块\n            for (\n                let row = startGenerateRow;\n                row < startGenerateRow + columnList.length;\n                row++\n            ) {\n                const targetLocation = {\n                    row: startDropRow++,\n                    column: column,\n                };\n                // 添加到入口列表\n                entryList.push(targetLocation);\n                // 生成随机方块\n                const randomBlockConfig = getRandomBlockConfig();\n                const block = this.generateBlock(\n                    targetLocation,\n                    randomBlockConfig,\n                    this._grid.getCellPosition({\n                        row,\n                        column,\n                    })\n                );\n                // 记录\n                blockDropInfos.push({\n                    location: targetLocation,\n                    block,\n                    dropTime: 0.3,\n                    targetDropLocation: targetLocation,\n                });\n            }\n        }\n        // 方块掉落动画\n        let step = 0;\n        const actionCd = () => {\n            step++;\n            if (step === blockDropInfos.length) {\n                cd(entryList);\n            }\n        };\n        for (const blockDropInfo of blockDropInfos) {\n            const { block, dropTime, targetDropLocation } = blockDropInfo;\n            const targetPos = this._grid.getCellPosition(targetDropLocation);\n            cc.tween(block.node)\n                .sequence(cc.moveTo(dropTime, targetPos), cc.callFunc(actionCd))\n                .start();\n        }\n    }\n\n    /**\n     * 生成新特殊方块\n     * @param gameCheckInfo 游戏检查信息\n     */\n    public generateNewSpecialBlocks(gameCheckInfo: GameCheckInfo): void {\n        const { newSpecailBlocks } = gameCheckInfo;\n        const keys = Object.keys(newSpecailBlocks);\n        for (const key of keys) {\n            const location = parseLocation(key);\n            const isEmpty = this._grid.getCell(location) === null;\n            if (isEmpty) {\n                const blockConfig = newSpecailBlocks[key];\n                this.generateBlock(location, blockConfig);\n            }\n        }\n    }\n\n    /**\n     * 生成方块\n     * @param location 位置\n     * @param blockConfig 方块配置\n     * @returns 方块\n     */\n    public generateBlock(\n        location: Location,\n        blockConfig: BlockConfig,\n        initPos?: cc.Vec2\n    ): BaseBlock {\n        const blockParent = this.getBlockParent(blockConfig.type);\n        const block = this._blockMgr.getBlock(blockConfig, blockParent);\n        this._grid.setCell(location, block);\n        block.node.setPosition(initPos || this._grid.getCellPosition(location));\n        return block;\n    }\n\n    // 获取方块地图信息\n    public getBlockMapInfo(): Array<Array<BlockConfig>> {\n        return this._grid\n            .getData()\n            .map((row) => row.map((block) => block && block.getConfig()));\n    }\n\n    public isInBounds(location: Location): boolean {\n        return this._grid.isInBounds(location);\n    }\n\n    public getLevelConfig(): LevelConfig {\n        return this._levelConfig;\n    }\n\n    public getAllBlock(): Array<BaseBlock> {\n        const blockList = this.gridRootNode.getComponentsInChildren(BaseBlock);\n        return blockList;\n    }\n}\n"]}